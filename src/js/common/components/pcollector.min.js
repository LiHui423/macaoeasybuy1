'use strict';//
var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) {
        return typeof t
    } : function (t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
    },
    pcollector = {
        initialized: !1,
        data: {
            albumList: {
                targetURL: 'http://social1.macaoeasybuy.com/thealbumSocialConntroller/queryUserAlbums.easy',
                parameters: {
                    page: 0,
                    size: 8,
                    order: 'uptime',
                    descOrasc: 'desc',
                    userId: void 0
                },
                encryptData: !0
            },
            uploadData: {}
        },
        settings: {
            panelContainer: '.pcollector-container',
            pictureListContainer: '.pcollector-container .picture-list',
            albumListContainer: '.pcollector-container .album-list',
            closeButton: '.panel-close-btn',
            createButton: '.create-album button',
            newAlbumNameInput: '.create-album input',
            collectButton: '.panel-footer button'
        },
        methods: {
            $el: void 0,
            $data: void 0,
            $settings: void 0,
            $methods: void 0,
            insertHTML: function () {
                var t = this.$methods;
                $('head > link[rel="stylesheet"]:last').after('<link rel="stylesheet" href="/src/css/common/components/pcollector.min.css">'), $('#pcollector').load('/page/common/components/pcollector.html .pcollector-panel'), t.bindEvent()
            },
            bindEvent: function () {
                var t = this.$settings,
                    e = this.$methods;
                $(t.closeButton).on('click', function () {
                    e.displayPanel(!1)
                }), $(t.createButton).on('click', function () {
                    e.createNewAlbum($(t.newAlbumNameInput).val())
                }), $(t.collectButton).on('click', function () {
                    e.collect()
                })
            },
            displayPanel: function (t) {
                var e = this.$settings;
                t ? $(e.panelContainer).css('display', 'block') : $(e.panelContainer).css('display', 'none')
            },
            init: function () {
                this.insertHTML(), this.insertAlbumList()
            },
            open: function (t) {
                var e = this.methods;
                e.insertPictureList(t), e.changeSize(), e.displayPanel(!0)
            },
            changeSize: function () {
                $('.picture-list img').each(function () {
                    this.height > this.width && $(this).addClass('h');
                    var t = $(this).attr('src');
                    $(this).css('background-image', 'url(' + t + ')').attr('src', '/img/common/pixel.png')
                })
            },
            changeSizeAlbum: function () {
                $('.album-list img').each(function () {
                    this.height > this.width && $(this).addClass('h');
                    var t = $(this).attr('src');
                    $(this).css('background-image', 'url(' + t + ')').attr('src', '/img/common/pixel.png')
                })
            },
            collect: function () {
                var t = this.$settings,
                    e = this.$data.uploadData,
                    a = this.$methods;
                e.collects = [], e.ids = '';
                var i = $(t.pictureListContainer).children();
                i.each(function (t) {
                    var a = '' === $(this).find('textarea').val() ? $(this).find('textarea').attr('placeholder') : $(this).find('textarea').val();
                    e.collects.push({
                        desc: a,
                        pic: '',
                        id: $(this).data('id')
                    }), t !== i.length - 1 ? e.ids += $(this).data('id') + ',' : e.ids += $(this).data('id')
                }), e.userId = easyBuy.easyUser.id, e.userName = easyBuy.easyUser.name, !!(e.albumId && e.albumName && e.userId && e.userName && 0 !== e.collects.length) ? a.requestData(e) : !e.albumId && alert('未選擇專輯')
            },
            requestData: function (t) {
                this.$methods;
                $.ajax({
                    url: 'http://social1.macaoeasybuy.com/thealbumSocialConntroller/collectAlbum.easy?collects=' + JSON.stringify(t) + '&easybuyCallback=?',
                    dataType: 'JSON',
                    methods: 'GET',
                    success: function (t) {
                        console.log(t)
                    },
                    error: function (t) {
                        console.log(t)
                    }
                })
            },
            createNewAlbum: function (t) {
                var e = this.$settings,
                    a = this.$methods,
                    i = $(e.newAlbumNameInput);
                if (t) {
                    i.removeAttr('placeholder').val(''), $(e.albumListContainer).prepend('<li class="album-item" data-total="0"><div class="img-container"></div><span>' + t + '</span></li>');
                    var s = $(e.albumListContainer).children().eq(0);
                    s.data('albumName', t), s.data('albumId', -1), s.on('click', function () {
                        a.albumSelected($(this))
                    }), a.albumSelected(s)
                } else i.attr('placeholder', '請輸入新專輯的名稱')
            },
            albumSelected: function (t) {
                var e = this.$data.uploadData;
                t.hasClass('yez-active') ? (e.albumId = void 0, e.albumName = '') : (e.albumId = t.data('albumId'), e.albumName = t.data('albumName')), t.toggleClass('yez-active'), t.siblings('.yez-active').toggleClass('yez-active'), $('.active-album-name').html('當前選中的專輯為：' + e.albumName)
            },
            insertPictureList: function (t) {
                var e = this.$settings,
                    a = this.$methods,
                    i = $(e.pictureListContainer);
                a.textAreaChange(!1);
                var s = a.generatePictureListHTML(t);
                i.html(s), i.children().each(function () {
                    $(this).data('id', $(this).attr('id')), a.textAreaChange($(this).find('textarea'))
                })
            },
            textAreaChange: function (t) {
                var e = this.$settings;
                if ('object' === (void 0 === t ? 'undefined' : _typeof(t))) t.on('focus', function () {
                    !$(this).val() && $(this).val(t.attr('placeholder'))
                }), t.on('blur', function () {
                    $(this).val() === t.attr('placeholder') ? $(this).val('') : '' === $(this).val() && $(this).attr('placeholder', '')
                });
                else {
                    var a = $(e.pictureListContainer).find('textarea');
                    0 !== a.length && a.each(function () {
                        $(this).off('focus'), $(this).off('blur')
                    })
                }
            },
            generatePictureListHTML: function (t) {
                return Object.keys(t).reduce(function (e, a) {
                    var i = void 0 !== t[a].desc ? t[a].desc : '';
                    return e + '<li class="picture-item" id="' + a + '"><div class="item-img"><div class="img-container"><img class="e" src="//mbuy.oss-cn-hongkong.aliyuncs.com/' + t[a].pic + '"></div></div><div class="item-content"><textarea class="scrollIe scrollOther" placeholder="' + i + '"></textarea></div></li>'
                }, '')
            },
            generateAlbumItem: function (t) {
                return t.data.reduce(function (t, e) {
                    return t + '<li id="' + e.albumId + '" class="album-item" data-total="' + e.picCount + '"><div class="img-container"><img class="e" src="//mbuy.oss-cn-hongkong.aliyuncs.com/' + e.coverPic + '"></div><span>' + e.albumTitle + '</span></li>'
                }, '')
            },
            getAlbumList: function (t) {
                var e = this.$methods,
                    a = this.$data;
                $.ajax({
                    method: 'GET',
                    dataType: 'JSON',
                    url: e.getRequestURL(a.albumList),
                    beforeSend: function () {
                        e.lazyload && e.lazyload(!1)
                    },
                    success: function (e) {
                        var i = {
                            page: a.albumList.parameters.page,
                            data: e.result
                        };
                        t && t(i)
                    }
                })
            },
            insertAlbumList: function () {
                var t = this.$methods,
                    e = this.$settings,
                    a = this.$data,
                    i = $(e.albumListContainer);
                t.getAlbumList(function (e) {
                    0 === e.page ? i.html(t.generateAlbumItem(e)) : i.append(t.generateAlbumItem(e)), $.each(e.data, function () {
                        var e = i.children('#' + this.albumId);
                        e.data('albumId', this.albumId), e.data('albumName', this.albumTitle), e.on('click', function () {
                            t.albumSelected(e)
                        })
                    }), t.changeSizeAlbum(), e.data.length < a.albumList.parameters.size ? t.lazyload = null : (t.lazyload(!0), a.albumList.parameters.page++)
                })
            },
            lazyload: function (t) {
                var e = this.$methods;
                t ? easyBuy.global.dep.easyScrollRequest('on', 'al', $('.list-container'), $('.list-container > ul.album-list'), function () {
                    e.insertAlbumList()
                }) : easyBuy.global.dep.easyScrollRequest('off', 'al', $('.list-container'))
            },
            getRequestURL: function (t) {
                if (void 0 !== t.targetURL && '' !== t.targetURL) {
                    var e = t.targetURL,
                        a = t.parameters;
                    t.encryptData;
                    return e + '?' + Object.keys(a).reduce(function (t, e) {
                        return t + e + '=' + a[e] + '&'
                    }, '') + 'easybuyCallback=?'
                }
                return !1
            }
        },
        initialize: function () {
            var t = this;
            this.methods.$el = t, this.methods.$data = t.data, this.methods.$settings = t.settings, this.methods.$methods = t.methods, this.data.albumList.parameters.userId = easyBuy.easyUser.id, this.methods.init()
        },
        open: function (t) {
            !this.initialized && this.initialize() && (this.initialized = !this.initialized), this.open = this.methods.open, this.open(t)
        }
    };
//# sourceMappingURL=pcollector.min.js.map
